<!DOCTYPE html PUBLIC "-//WAPFORUM//DTD XHTML Mobile 1.0//EN" "http://www.wapforum.org/DTD/xhtml-mobile10.dtd">
<html>
  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=yes">
  
  
  <title>  Homebrew 安装 PHP环境 |   «｛ 小站 /〉 </title>

 
  <link rel="stylesheet" href="/nayo.min.css"> 
</head>  
  <body>   
    
      <header class="header">
	
  <nav class="header-nav">        

    <span class="iconfont icon-menu mobile-toggle"></span>   	

    <div class="header-menu">          
              
          
            <a class="header-menu-link" id="header-menu-home" href="/">
              <i class="iconfont icon-home">  
            </i></a>     
          
              
          
            <a class="header-menu-link" id="header-menu-archives" href="/archives">
              <i class="iconfont icon-archives">  
            </i></a>     
          
              
          
            <a class="header-menu-link" id="header-menu-search">
              <i class="iconfont icon-search">  
            </i></a>
          
                  
    </div>  
    
  </nav>
</header>

   

      <div class="container">       
          
          
            <section class="main">  
          

          <article class="post">
  
	<div class="post-header">

	<p class="post-title">	
		Homebrew 安装 PHP环境
	</p>
			

	<div class="meta-info">	
	<span>
		Aug 26, 2015
	</span>

	
	
		<i class="iconfont icon-words"></i>
		<span>
			7131
		</span>
	
</div>

</div> 
	 

	  <div class="typo post-content slideDownMin">

		

			
					<blockquote>
<p>homebrew 是 os x 上的包管理控制器类似于 apt-get 、yum 官网是 <a href="http://brew.sh" target="_blank" rel="noopener">http://brew.sh</a></p>
</blockquote>
<h2 id="安装方式-Homebrew"><a href="#安装方式-Homebrew" class="headerlink" title="安装方式 Homebrew"></a>安装方式 Homebrew</h2><p>打开 终端 执行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ruby -e <span class="string">"<span class="variable">$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)</span>"</span></span><br></pre></td></tr></table></figure>
<p>安装完成后更新 brew 源</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew update <span class="comment">#更新brew</span></span><br></pre></td></tr></table></figure>
<h3 id="brew-常用命令"><a href="#brew-常用命令" class="headerlink" title="brew 常用命令"></a>brew 常用命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">brew install APPNAME <span class="comment">#安装应用</span></span><br><span class="line"></span><br><span class="line">brew search APPNAME <span class="comment"># 搜索已有应用</span></span><br><span class="line"></span><br><span class="line">brew tap  GIHUB/user <span class="comment"># 安装扩展</span></span><br><span class="line"></span><br><span class="line">brew uncap GITHUB/user <span class="comment">#移除扩展</span></span><br><span class="line"></span><br><span class="line">brew remove APPNAME <span class="comment">#移除应用</span></span><br><span class="line"></span><br><span class="line">brew upgrade APPNAME <span class="comment">#更新应用</span></span><br><span class="line"></span><br><span class="line">brew options APPNAME <span class="comment">#查看安装信息</span></span><br><span class="line"></span><br><span class="line">brew info APPNAME <span class="comment">#查看应用信息</span></span><br></pre></td></tr></table></figure>
<a id="more"></a>
<h2 id="安装-mysql"><a href="#安装-mysql" class="headerlink" title="安装 mysql"></a>安装 mysql</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install homebrew/versions/mysql56</span><br></pre></td></tr></table></figure>
<h3 id="MySQL开机启动："><a href="#MySQL开机启动：" class="headerlink" title="MySQL开机启动："></a>MySQL开机启动：</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ln -sfv /usr/<span class="built_in">local</span>/opt/mysql56/*.plist ~/Library/LaunchAgents</span><br><span class="line">launchctl load ~/Library/LaunchAgents/homebrew.mxcl.mysql56.plist</span><br></pre></td></tr></table></figure>
<h3 id="安装完成之后开启MySQL安全机制："><a href="#安装完成之后开启MySQL安全机制：" class="headerlink" title="安装完成之后开启MySQL安全机制："></a>安装完成之后开启MySQL安全机制：</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/<span class="built_in">local</span>/opt/mysql56/bin/mysql_secure_installation</span><br></pre></td></tr></table></figure>
<h2 id="安装-PHP-5-6"><a href="#安装-PHP-5-6" class="headerlink" title="安装 PHP 5.6"></a>安装 PHP 5.6</h2><h3 id="添加-PHP-扩展"><a href="#添加-PHP-扩展" class="headerlink" title="添加 PHP 扩展"></a>添加 PHP 扩展</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">brew tap homebrew/dupes</span><br><span class="line">brew tap josegonzalez/homebrew-php</span><br></pre></td></tr></table></figure>
<blockquote>
<p>可以使用brew options php56命令来查看安装选项</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install php56 --with-fpm --with-debug --with-gmp --with-imap --with-tidy --with-mysql --with-libmysql --with-homebrew-curl --with-homebrew-openssl --without-snmp</span><br></pre></td></tr></table></figure>
<h3 id="安装-PHP-扩展"><a href="#安装-PHP-扩展" class="headerlink" title="安装 PHP 扩展"></a>安装 PHP 扩展</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">brew install php56-apcu\</span><br><span class="line"> php56-gearman\</span><br><span class="line"> php56-geoip\</span><br><span class="line"> php56-gmagick\</span><br><span class="line"> php56-imagick\</span><br><span class="line"> php56-intl\</span><br><span class="line"> php56-mcrypt\</span><br><span class="line"> php56-redis\</span><br><span class="line"> php56-sphinx\</span><br><span class="line"> php56-mongo\</span><br><span class="line"> php56-mongodb\</span><br><span class="line"> php56-xdebug;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>由于Mac自带了php和php-fpm，因此需要添加系统环境变量PATH来替代自带PHP版本。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">'export PATH="$(brew --prefix php56)/bin:$PATH"'</span> &gt;&gt; ~/.bash_profile  <span class="comment">#for php</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'export PATH="$(brew --prefix php56)/sbin:$PATH"'</span> &gt;&gt; ~/.bash_profile  <span class="comment">#for php-fpm</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'export PATH="/usr/local/bin:/usr/local/sbin:$PATH"'</span> &gt;&gt; ~/.bash_profile <span class="comment">#for other brew install soft</span></span><br><span class="line"><span class="built_in">source</span> ~/.bash_profile</span><br></pre></td></tr></table></figure>
<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">php -v    </span><br><span class="line">PHP 5.6.12 (cli) (built: Aug 25 2015 06:24:07) (DEBUG)</span><br><span class="line">Copyright (c) 1997-2015 The PHP Group</span><br><span class="line">Zend Engine v2.6.0, Copyright (c) 1998-2015 Zend Technologies</span><br></pre></td></tr></table></figure>
<blockquote>
<p>修改php-fpm配置文件，vim /usr/local/etc/php/5.6/php-fpm.conf，找到pid相关大概在25行，去掉注释 pid = run/php-fpm.pid, 那么php-fpm的pid文件就会自动产生在/usr/local/var/run/php-fpm.pid，下面要安装的Nginx pid文件也放在这里。</p>
</blockquote>
<h3 id="测试php-fpm配置"><a href="#测试php-fpm配置" class="headerlink" title="测试php-fpm配置"></a>测试php-fpm配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">php-fpm -t</span><br><span class="line">php-fpm -c /usr/<span class="built_in">local</span>/etc/php/5.6/php.ini -y /usr/<span class="built_in">local</span>/etc/php/5.6/php-fpm.conf -t</span><br></pre></td></tr></table></figure>
<h3 id="启动php-fpm"><a href="#启动php-fpm" class="headerlink" title="启动php-fpm"></a>启动php-fpm</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">php-fpm -D</span><br><span class="line">php-fpm -c /usr/<span class="built_in">local</span>/etc/php/5.6/php.ini -y /usr/<span class="built_in">local</span>/etc/php/5.6/php-fpm.conf -D</span><br></pre></td></tr></table></figure>
<h3 id="关闭php-fpm"><a href="#关闭php-fpm" class="headerlink" title="关闭php-fpm"></a>关闭php-fpm</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">kill</span> -INT `cat /usr/<span class="built_in">local</span>/var/run/php-fpm.pid`</span><br></pre></td></tr></table></figure>
<h3 id="重启php-fpm"><a href="#重启php-fpm" class="headerlink" title="重启php-fpm"></a>重启php-fpm</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">kill</span> -USR2 `cat /usr/<span class="built_in">local</span>/var/run/php-fpm.pid`</span><br></pre></td></tr></table></figure>
<h3 id="使用命令来启动php-fpm"><a href="#使用命令来启动php-fpm" class="headerlink" title="使用命令来启动php-fpm"></a>使用命令来启动php-fpm</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">launchctl load -w ~/Library/LaunchAgents/homebrew.mxcl.php56.plist</span><br></pre></td></tr></table></figure>
<blockquote>
<p>启动php-fpm之后，确保它正常运行监听9000端口：</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">lsof -Pni4 | grep LISTEN | grep php</span><br><span class="line">php-fpm   30907 XXX    9u  IPv4 0x9f5ee1b4361405d3      0t0  TCP 127.0.0.1:9000 (LISTEN)</span><br></pre></td></tr></table></figure>
<h3 id="PHP-FPM开机启动："><a href="#PHP-FPM开机启动：" class="headerlink" title="PHP-FPM开机启动："></a>PHP-FPM开机启动：</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ln -sfv /usr/<span class="built_in">local</span>/opt/php56/*.plist ~/Library/LaunchAgents</span><br><span class="line">launchctl load ~/Library/LaunchAgents/homebrew.mxcl.php56.plist</span><br></pre></td></tr></table></figure>
<h2 id="安装php-composer"><a href="#安装php-composer" class="headerlink" title="安装php composer"></a>安装php composer</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install composer</span><br></pre></td></tr></table></figure>
<h3 id="检查一下情况"><a href="#检查一下情况" class="headerlink" title="检查一下情况"></a>检查一下情况</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">composer --version</span><br><span class="line">Composer version 1.0.0-alpha8 2014-01-06 18:39:59</span><br></pre></td></tr></table></figure>
<h2 id="安装Nginx"><a href="#安装Nginx" class="headerlink" title="安装Nginx"></a>安装Nginx</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install nginx --with-http_geoip_module</span><br></pre></td></tr></table></figure>
<h3 id="测试配置是否有语法错误"><a href="#测试配置是否有语法错误" class="headerlink" title="测试配置是否有语法错误"></a>测试配置是否有语法错误</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx -t</span><br></pre></td></tr></table></figure>
<h3 id="打开-nginx"><a href="#打开-nginx" class="headerlink" title="打开 nginx"></a>打开 nginx</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nginx</span><br></pre></td></tr></table></figure>
<h3 id="重新加载配置-重启-停止-退出-nginx"><a href="#重新加载配置-重启-停止-退出-nginx" class="headerlink" title="重新加载配置|重启|停止|退出 nginx"></a>重新加载配置|重启|停止|退出 nginx</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx -s reload|reopen|stop|quit</span><br></pre></td></tr></table></figure>
<blockquote>
<p>也可以使用Mac的launchctl来启动|停止</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">launchctl unload ~/Library/LaunchAgents/homebrew.mxcl.nginx.plist</span><br><span class="line">launchctl load -w ~/Library/LaunchAgents/homebrew.mxcl.nginx.plist</span><br></pre></td></tr></table></figure>
<h3 id="Nginx开机启动"><a href="#Nginx开机启动" class="headerlink" title="Nginx开机启动"></a>Nginx开机启动</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ln -sfv /usr/<span class="built_in">local</span>/opt/nginx/*.plist ~/Library/LaunchAgents</span><br><span class="line">launchctl load ~/Library/LaunchAgents/homebrew.mxcl.nginx.plist</span><br></pre></td></tr></table></figure>
<p>Nginx监听80端口需要root权限执行，因此：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo chown root:wheel /usr/<span class="built_in">local</span>/Cellar/nginx/1.6.0_1/bin/nginx</span><br><span class="line">sudo chmod u+s /usr/<span class="built_in">local</span>/Cellar/nginx/1.6.0_1/bin/nginx</span><br></pre></td></tr></table></figure>
<h2 id="创建-NGINX-配置"><a href="#创建-NGINX-配置" class="headerlink" title="创建 NGINX 配置"></a>创建 NGINX 配置</h2><h3 id="配置nginx-conf创建需要用到的目录："><a href="#配置nginx-conf创建需要用到的目录：" class="headerlink" title="配置nginx.conf创建需要用到的目录："></a>配置nginx.conf创建需要用到的目录：</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /usr/<span class="built_in">local</span>/var/logs/nginx</span><br><span class="line">mkdir -p /usr/<span class="built_in">local</span>/etc/nginx/sites-available</span><br><span class="line">mkdir -p /usr/<span class="built_in">local</span>/etc/nginx/sites-enabled</span><br><span class="line">mkdir -p /usr/<span class="built_in">local</span>/etc/nginx/conf.d</span><br><span class="line">mkdir -p /usr/<span class="built_in">local</span>/etc/nginx/ssl</span><br><span class="line">sudo mkdir -p /var/www</span><br><span class="line">sudo chown :staff /var/www</span><br><span class="line">sudo chmod 775 /var/www</span><br></pre></td></tr></table></figure>
<blockquote>
<p>创建配置文件</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/<span class="built_in">local</span>/etc/nginx/nginx.conf</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">worker_processes  1;</span><br><span class="line"></span><br><span class="line">error_log   /usr/<span class="built_in">local</span>/var/logs/nginx/error.log debug;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pid        /usr/<span class="built_in">local</span>/var/run/nginx.pid;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  256;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    log_format  main  <span class="string">'$remote_addr - $remote_user [$time_local] "$request" '</span></span><br><span class="line">                      <span class="string">'$status $body_bytes_sent "$http_referer" '</span></span><br><span class="line">                      <span class="string">'"$http_user_agent" "$http_x_forwarded_for"'</span>;</span><br><span class="line"></span><br><span class="line">    access_log  /usr/<span class="built_in">local</span>/var/logs/access.log  main;</span><br><span class="line"></span><br><span class="line">    sendfile        on;</span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line">    port_in_redirect off;</span><br><span class="line"></span><br><span class="line">    include /usr/<span class="built_in">local</span>/etc/nginx/sites-enabled/*;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="设置-nginx-php-fpm-配置文件"><a href="#设置-nginx-php-fpm-配置文件" class="headerlink" title="设置 nginx php-fpm 配置文件"></a>设置 nginx php-fpm 配置文件</h2><blockquote>
<p>创建 php-fpm 配置</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/<span class="built_in">local</span>/etc/nginx/conf.d/php-fpm</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#proxy the php scripts to php-fpm</span></span><br><span class="line">location ~ \.php$ &#123;</span><br><span class="line">    try_files                   <span class="variable">$uri</span> = 404;</span><br><span class="line">    fastcgi_pass                127.0.0.1:9000;</span><br><span class="line">    fastcgi_index               index.php;</span><br><span class="line">    fastcgi_intercept_errors    on;</span><br><span class="line">    include /usr/<span class="built_in">local</span>/etc/nginx/fastcgi.conf;</span><br><span class="line">&#125;</span><br><span class="line"> nginx虚拟主机准备工作</span><br><span class="line"></span><br><span class="line"><span class="comment">#创建 info.php index.html 404.html 403.html文件到 /var/www 下面</span></span><br><span class="line">vi /var/www/info.php</span><br><span class="line">vi /var/www/index.html</span><br><span class="line">vi /var/www/403.html</span><br><span class="line">vi /var/www/404.html</span><br><span class="line"> 创建默认虚拟主机defaultvim /usr/<span class="built_in">local</span>/etc/nginx/sites-available/default输入：</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen       80;</span><br><span class="line">    server_name  localhost;</span><br><span class="line">    root         /var/www/;</span><br><span class="line"></span><br><span class="line">    access_log  /usr/<span class="built_in">local</span>/var/logs/nginx/default.access.log  main;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        index  index.html index.htm index.php;</span><br><span class="line">        autoindex   on;</span><br><span class="line">        include     /usr/<span class="built_in">local</span>/etc/nginx/conf.d/php-fpm;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location = /info &#123;</span><br><span class="line">        allow   127.0.0.1;</span><br><span class="line">        deny    all;</span><br><span class="line">        rewrite (.*) /.info.php;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    error_page  404     /404.html;</span><br><span class="line">    error_page  403     /403.html;</span><br><span class="line">&#125;</span><br><span class="line"> 创建ssl默认虚拟主机default-sslvim /usr/<span class="built_in">local</span>/etc/nginx/sites-available/default-ssl输入：</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen       443;</span><br><span class="line">    server_name  localhost;</span><br><span class="line">    root       /var/www/;</span><br><span class="line"></span><br><span class="line">    access_log  /usr/<span class="built_in">local</span>/var/logs/nginx/default-ssl.access.log  main;</span><br><span class="line"></span><br><span class="line">    ssl                  on;</span><br><span class="line">    ssl_certificate      ssl/localhost.crt;</span><br><span class="line">    ssl_certificate_key  ssl/localhost.key;</span><br><span class="line"></span><br><span class="line">    ssl_session_timeout  5m;</span><br><span class="line"></span><br><span class="line">    ssl_protocols  SSLv2 SSLv3 TLSv1;</span><br><span class="line">    ssl_ciphers  HIGH:!aNULL:!MD5;</span><br><span class="line">    ssl_prefer_server_ciphers   on;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        include   /usr/<span class="built_in">local</span>/etc/nginx/conf.d/php-fpm;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location = /info &#123;</span><br><span class="line">        allow   127.0.0.1;</span><br><span class="line">        deny    all;</span><br><span class="line">        rewrite (.*) /.info.php;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    error_page  404     /404.html;</span><br><span class="line">    error_page  403     /403.html;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>设置SSL</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /usr/<span class="built_in">local</span>/etc/nginx/ssl</span><br><span class="line">openssl req -new -newkey rsa:4096 -days 365 -nodes -x509 -subj <span class="string">"/C=US/ST=State/L=Town/O=Office/CN=localhost"</span> -keyout /usr/<span class="built_in">local</span>/etc/nginx/ssl/localhost.key -out /usr/<span class="built_in">local</span>/etc/nginx/ssl/localhost.crt</span><br></pre></td></tr></table></figure>
<h3 id="创建虚拟主机软连接，开启虚拟主机"><a href="#创建虚拟主机软连接，开启虚拟主机" class="headerlink" title="创建虚拟主机软连接，开启虚拟主机"></a>创建虚拟主机软连接，开启虚拟主机</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ln -sfv /usr/<span class="built_in">local</span>/etc/nginx/sites-available/default /usr/<span class="built_in">local</span>/etc/nginx/sites-enabled/default</span><br><span class="line">ln -sfv /usr/<span class="built_in">local</span>/etc/nginx/sites-available/default-ssl /usr/<span class="built_in">local</span>/etc/nginx/sites-enabled/default-ssl</span><br></pre></td></tr></table></figure>
<h2 id="启动-停止Nginx"><a href="#启动-停止Nginx" class="headerlink" title="启动|停止Nginx"></a>启动|停止Nginx</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">launchctl load -w ~/Library/LaunchAgents/homebrew.mxcl.nginx.plist</span><br><span class="line">launchctl unload -w ~/Library/LaunchAgents/homebrew.mxcl.nginx.plist</span><br></pre></td></tr></table></figure>
<h2 id="快捷服务控制命令"><a href="#快捷服务控制命令" class="headerlink" title="快捷服务控制命令"></a>快捷服务控制命令</h2><blockquote>
<p>为了后面管理方便，将命令 alias 下，vim ~/.bash_aliases 输入一下内容：</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">alias</span> nginx.start=<span class="string">'launchctl load -w ~/Library/LaunchAgents/homebrew.mxcl.nginx.plist'</span></span><br><span class="line"><span class="built_in">alias</span> nginx.stop=<span class="string">'launchctl unload -w ~/Library/LaunchAgents/homebrew.mxcl.nginx.plist'</span></span><br><span class="line"><span class="built_in">alias</span> nginx.restart=<span class="string">'nginx.stop &amp;&amp; nginx.start'</span></span><br><span class="line"><span class="built_in">alias</span> php-fpm.start=<span class="string">"launchctl load -w ~/Library/LaunchAgents/homebrew.mxcl.php56.plist"</span></span><br><span class="line"><span class="built_in">alias</span> php-fpm.stop=<span class="string">"launchctl unload -w ~/Library/LaunchAgents/homebrew.mxcl.php56.plist"</span></span><br><span class="line"><span class="built_in">alias</span> php-fpm.restart=<span class="string">'php-fpm.stop &amp;&amp; php-fpm.start'</span></span><br><span class="line"><span class="built_in">alias</span> mysql.start=<span class="string">"launchctl load -w ~/Library/LaunchAgents/homebrew.mxcl.mysql.plist"</span></span><br><span class="line"><span class="built_in">alias</span> mysql.stop=<span class="string">"launchctl unload -w ~/Library/LaunchAgents/homebrew.mxcl.mysql.plist"</span></span><br><span class="line"><span class="built_in">alias</span> mysql.restart=<span class="string">'mysql.stop &amp;&amp; mysql.start'</span></span><br><span class="line"><span class="built_in">alias</span> redis.start=<span class="string">"launchctl load -w ~/Library/LaunchAgents/homebrew.mxcl.redis.plist"</span></span><br><span class="line"><span class="built_in">alias</span> redis.stop=<span class="string">"launchctl unload -w ~/Library/LaunchAgents/homebrew.mxcl.redis.plist"</span></span><br><span class="line"><span class="built_in">alias</span> redis.restart=<span class="string">'redis.stop &amp;&amp; redis.start'</span></span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line">&gt;让快捷命令生效</span><br><span class="line">```bash</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"[[ -f ~/.bash_aliases ]] &amp;&amp; . ~/.bash_aliases"</span> &gt;&gt; ~/.bash_profile     </span><br><span class="line"><span class="built_in">source</span> ~/.bash_profile</span><br></pre></td></tr></table></figure>  	
					
	  </div>     
	  

	
<div class="post-meta">
      	

      
        <i class="iconfont icon-tag"></i>     
          <a class="tag-link" href="/tags/homebrew/">homebrew</a> <a class="tag-link" href="/tags/php/">php</a>    
      	
</div>





<div class="post-footer">
  <div class="pf-left">
      <img class="pf-avatar" src="/images/header.jpg">
      <p class="pf-des">Zack Lee</p>
  </div>

  <div class="pf-right">           
      <div class="pf-links">
         
        
	
<script id="-mob-share" src="http://f1.webshare.mob.com/code/mob-share.js?appkey=21d601593a1de"></script>
	
	<span class="share-btn">
	<span class="iconfont icon-share"></span>
	</span>


	<div class="-mob-share sildeUpMin">
		   			             
            <a class="iconfont  icon-share-weixin -mob-share-weixin"></a>		
     	   			             
            <a class="iconfont  icon-share-twitter -mob-share-twitter"></a>		
     	   
	</div>	

      </div>  
    <nav class="pf-paginator">
      
         
          <a href="/2015/11/02/Oh-My-Zsh/" data-hover="Oh My Zsh">Prev</a>      
            
        
      
        
        <a href="/2015/07/09/VIM-配色方案-Molokai/" data-hover="VIM 配色方案 Molokai"> Next</a>
            
  </nav>   
  </div>
</div> 
	
	
</article>

	<div class="toc-container">
			<div class="sidebar">
			<p class="toc-title">
				<i class="iconfont icon-toc"></i>
				Contents
			</p>
			<div class="toc-list">
				<ol class="toc-inner"><li class="toc-inner-item toc-inner-level-2"><a class="toc-inner-link" href="#安装方式-Homebrew"><span class="toc-inner-text">安装方式 Homebrew</span></a><ol class="toc-inner-child"><li class="toc-inner-item toc-inner-level-3"><a class="toc-inner-link" href="#brew-常用命令"><span class="toc-inner-text">brew 常用命令</span></a></li></ol></li><li class="toc-inner-item toc-inner-level-2"><a class="toc-inner-link" href="#安装-mysql"><span class="toc-inner-text">安装 mysql</span></a><ol class="toc-inner-child"><li class="toc-inner-item toc-inner-level-3"><a class="toc-inner-link" href="#MySQL开机启动："><span class="toc-inner-text">MySQL开机启动：</span></a></li><li class="toc-inner-item toc-inner-level-3"><a class="toc-inner-link" href="#安装完成之后开启MySQL安全机制："><span class="toc-inner-text">安装完成之后开启MySQL安全机制：</span></a></li></ol></li><li class="toc-inner-item toc-inner-level-2"><a class="toc-inner-link" href="#安装-PHP-5-6"><span class="toc-inner-text">安装 PHP 5.6</span></a><ol class="toc-inner-child"><li class="toc-inner-item toc-inner-level-3"><a class="toc-inner-link" href="#添加-PHP-扩展"><span class="toc-inner-text">添加 PHP 扩展</span></a></li><li class="toc-inner-item toc-inner-level-3"><a class="toc-inner-link" href="#安装-PHP-扩展"><span class="toc-inner-text">安装 PHP 扩展</span></a></li><li class="toc-inner-item toc-inner-level-3"><a class="toc-inner-link" href="#测试"><span class="toc-inner-text">测试</span></a></li><li class="toc-inner-item toc-inner-level-3"><a class="toc-inner-link" href="#测试php-fpm配置"><span class="toc-inner-text">测试php-fpm配置</span></a></li><li class="toc-inner-item toc-inner-level-3"><a class="toc-inner-link" href="#启动php-fpm"><span class="toc-inner-text">启动php-fpm</span></a></li><li class="toc-inner-item toc-inner-level-3"><a class="toc-inner-link" href="#关闭php-fpm"><span class="toc-inner-text">关闭php-fpm</span></a></li><li class="toc-inner-item toc-inner-level-3"><a class="toc-inner-link" href="#重启php-fpm"><span class="toc-inner-text">重启php-fpm</span></a></li><li class="toc-inner-item toc-inner-level-3"><a class="toc-inner-link" href="#使用命令来启动php-fpm"><span class="toc-inner-text">使用命令来启动php-fpm</span></a></li><li class="toc-inner-item toc-inner-level-3"><a class="toc-inner-link" href="#PHP-FPM开机启动："><span class="toc-inner-text">PHP-FPM开机启动：</span></a></li></ol></li><li class="toc-inner-item toc-inner-level-2"><a class="toc-inner-link" href="#安装php-composer"><span class="toc-inner-text">安装php composer</span></a><ol class="toc-inner-child"><li class="toc-inner-item toc-inner-level-3"><a class="toc-inner-link" href="#检查一下情况"><span class="toc-inner-text">检查一下情况</span></a></li></ol></li><li class="toc-inner-item toc-inner-level-2"><a class="toc-inner-link" href="#安装Nginx"><span class="toc-inner-text">安装Nginx</span></a><ol class="toc-inner-child"><li class="toc-inner-item toc-inner-level-3"><a class="toc-inner-link" href="#测试配置是否有语法错误"><span class="toc-inner-text">测试配置是否有语法错误</span></a></li><li class="toc-inner-item toc-inner-level-3"><a class="toc-inner-link" href="#打开-nginx"><span class="toc-inner-text">打开 nginx</span></a></li><li class="toc-inner-item toc-inner-level-3"><a class="toc-inner-link" href="#重新加载配置-重启-停止-退出-nginx"><span class="toc-inner-text">重新加载配置|重启|停止|退出 nginx</span></a></li><li class="toc-inner-item toc-inner-level-3"><a class="toc-inner-link" href="#Nginx开机启动"><span class="toc-inner-text">Nginx开机启动</span></a></li></ol></li><li class="toc-inner-item toc-inner-level-2"><a class="toc-inner-link" href="#创建-NGINX-配置"><span class="toc-inner-text">创建 NGINX 配置</span></a><ol class="toc-inner-child"><li class="toc-inner-item toc-inner-level-3"><a class="toc-inner-link" href="#配置nginx-conf创建需要用到的目录："><span class="toc-inner-text">配置nginx.conf创建需要用到的目录：</span></a></li></ol></li><li class="toc-inner-item toc-inner-level-2"><a class="toc-inner-link" href="#设置-nginx-php-fpm-配置文件"><span class="toc-inner-text">设置 nginx php-fpm 配置文件</span></a><ol class="toc-inner-child"><li class="toc-inner-item toc-inner-level-3"><a class="toc-inner-link" href="#创建虚拟主机软连接，开启虚拟主机"><span class="toc-inner-text">创建虚拟主机软连接，开启虚拟主机</span></a></li></ol></li><li class="toc-inner-item toc-inner-level-2"><a class="toc-inner-link" href="#启动-停止Nginx"><span class="toc-inner-text">启动|停止Nginx</span></a></li><li class="toc-inner-item toc-inner-level-2"><a class="toc-inner-link" href="#快捷服务控制命令"><span class="toc-inner-text">快捷服务控制命令</span></a></li></ol>
			</div>
		</div>
	</div>

          </section> 
      </div>            
    
    <a id="backTop">
      <span>
        <i class="iconfont icon-backtotop"></i>
      </span>
    </a> 

  
    
    <div class="search-container sildeUpMin">
        <div class="search-header">
            <input type="text" placeholder="Typing Something here." id="search-input" class="search-input">
            <span class="search-cancel">
                <i class="iconfont icon-cancel">
            </i></span>
        </div>
        <div id="search-result" class="search-result"></div>
    </div>
 
     <div class="mobile-menu">      

      
      <img class="mobile-menu-icon" src="/images/favicon.png">   
      

         
            

            <a class="mobile-menu-link" href="/">Home
            </a>
            
         
            

            <a class="mobile-menu-link" href="/archives">Archives
            </a>
            
         
                          

            <a class="mobile-menu-link mobile-menu-search" href="#">Search </a>                 
            
         
      
</div>        
    



     
    

<footer id="footer">	    

		
		<div class="footer-copyright">
		&copy;
		Zack Lee
		<br>

		Theme By
		<a href="https://github.com/Lemonreds/hexo-theme-Nayo" target="_blank">Nayo</a>	
		</div>			
	 
</footer>   

  

    <script src="/nayo.bundle.js"></script>           
  </body>        
</html>